<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nescafe Hub - Order Tracking</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    .font-orbitron {
      font-family: 'Orbitron', sans-serif;
    }

    .font-poppins {
      font-family: 'Poppins', sans-serif;
    }

    .navbar {
      transition: all 0.3s ease;
    }

    .navbar.scrolled {
      background-color: rgba(0, 0, 0, 0.9);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .mobile-menu {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }

    .mobile-menu.open {
      max-height: 500px;
    }

    .tab-button {
      transition: all 0.3s ease;
    }

    .tab-button.active {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .order-card {
      transition: all 0.3s ease;
    }

    .order-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }

    .status-badge {
      animation: pulse 2s infinite;
    }

    .status-badge.completed {
      animation: none;
    }

    .status-badge.cancelled {
      animation: none;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    .order-timeline {
      position: relative;
    }

    .order-timeline::before {
      content: '';
      position: absolute;
      left: 15px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(to bottom, #fbbf24, #f59e0b);
    }

    .timeline-item {
      position: relative;
      padding-left: 40px;
      margin-bottom: 20px;
    }

    .timeline-dot {
      position: absolute;
      left: 6px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #fbbf24;
      border: 3px solid white;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .cancel-animation {
      animation: cancelPulse 0.5s ease-in-out;
    }

    @keyframes cancelPulse {
      0% { transform: scale(1); }
      50% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }
  </style>
</head>

<body class="bg-gradient-to-br from-amber-50 to-orange-100 min-h-screen font-poppins">
  <!-- Navigation Bar -->
  <nav class="navbar fixed w-full z-50 px-8 py-3 md:px-20 bg-gray-900">
    <div class="container mx-auto flex justify-between items-center">
      <!-- Logo -->
      <div class="flex items-center">
        <a href="index.html" class="text-white text-2xl font-bold flex items-center">
          <i class="fas fa-coffee text-yellow-400 mr-2"></i>
          <span>Nescafe Hub</span>
        </a>
      </div>

      <!-- Desktop Menu -->
      <div class="hidden md:flex items-center space-x-8">
        <a href="index.html" class="text-white hover:text-yellow-400 transition">Home</a>
        <a href="menu.html" class="text-white hover:text-yellow-400 transition">Menu</a>
        <a href="order.html" class="text-yellow-400 transition">Order</a>
        <a href="reviews.html" class="text-white hover:text-yellow-400 transition">Review</a>
        <a href="index.html#contact" class="text-white hover:text-yellow-400 transition">Contact</a>
        <div class="relative">
          <a href="cart.html" class="text-white hover:text-yellow-400 transition relative">
            <i class="fas fa-shopping-cart text-xl"></i>
            <span id="cart-count" class="absolute -top-2 -right-2 bg-yellow-500 text-xs text-white rounded-full h-5 w-5 flex items-center justify-center">0</span>
          </a>
        </div>
      </div>

      <!-- Mobile Menu Button -->
      <div class="md:hidden flex items-center">
        <button class="text-white text-2xl focus:outline-none" id="mobile-menu-button">
          <i class="fas fa-bars"></i>
        </button>
        <div class="relative ml-4">
          <a href="cart.html" class="text-white">
            <i class="fas fa-shopping-cart text-xl"></i>
            <span id="cart-count-mobile" class="absolute -top-2 -right-2 bg-yellow-500 text-xs text-white rounded-full h-5 w-5 flex items-center justify-center">0</span>
          </a>
        </div>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div class="mobile-menu md:hidden bg-gray-900 mt-2 rounded-lg" id="mobile-menu">
      <div class="px-4 py-3 space-y-4">
        <a href="index.html" class="block text-white hover:text-yellow-400 transition">Home</a>
        <a href="menu.html" class="block text-white hover:text-yellow-400 transition">Menu</a>
        <a href="order.html" class="block text-yellow-400 transition">Order</a>
        <a href="reviews.html" class="block text-white hover:text-yellow-400 transition">Reviews</a>
        <a href="index.html#contact" class="block text-white hover:text-yellow-400 transition">Contact</a>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <section class="pt-32 pb-12 bg-gray-900 text-white">
    <div class="container mx-auto px-6 text-center">
      <h1 class="text-4xl md:text-5xl font-bold mb-4 font-orbitron">Order Tracking</h1>
      <p class="text-xl text-gray-300 max-w-2xl mx-auto">Track your coffee orders and manage your order history</p>
      <div class="mt-8 flex justify-center">
        <div class="bg-white/10 rounded-full px-6 py-2 backdrop-blur-sm">
          <i class="fas fa-clock text-yellow-400 mr-2"></i>
          <span id="current-time" class="text-sm"></span>
        </div>
      </div>
    </div>
  </section>

  <!-- Order Statistics -->
  <section class="py-8 bg-white/50">
    <div class="container mx-auto px-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div class="bg-white rounded-xl p-6 text-center shadow-lg">
          <div class="text-3xl font-bold text-blue-600" id="total-orders">0</div>
          <div class="text-gray-600 mt-2">Total Orders</div>
        </div>
        <div class="bg-white rounded-xl p-6 text-center shadow-lg">
          <div class="text-3xl font-bold text-yellow-600" id="pending-count">0</div>
          <div class="text-gray-600 mt-2">Pending</div>
        </div>
        <div class="bg-white rounded-xl p-6 text-center shadow-lg">
          <div class="text-3xl font-bold text-green-600" id="completed-count">0</div>
          <div class="text-gray-600 mt-2">Completed</div>
        </div>
        <div class="bg-white rounded-xl p-6 text-center shadow-lg">
          <div class="text-3xl font-bold text-red-600" id="cancelled-count">0</div>
          <div class="text-gray-600 mt-2">Cancelled</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Order Tabs -->
  <section class="py-8">
    <div class="container mx-auto px-6">
      <div class="flex flex-wrap justify-center mb-8 gap-4">
        <button class="tab-button active bg-yellow-500 text-white px-6 py-3 rounded-full font-semibold shadow-lg" data-tab="all">
          <i class="fas fa-list mr-2"></i>All Orders
        </button>
        <button class="tab-button bg-white text-gray-700 px-6 py-3 rounded-full font-semibold shadow-lg hover:bg-yellow-50" data-tab="pending">
          <i class="fas fa-clock mr-2"></i>Pending
        </button>
        <button class="tab-button bg-white text-gray-700 px-6 py-3 rounded-full font-semibold shadow-lg hover:bg-green-50" data-tab="completed">
          <i class="fas fa-check-circle mr-2"></i>Completed
        </button>
        <button class="tab-button bg-white text-gray-700 px-6 py-3 rounded-full font-semibold shadow-lg hover:bg-red-50" data-tab="cancelled">
          <i class="fas fa-times-circle mr-2"></i>Cancelled
        </button>
      </div>

      <!-- Order Content -->
      <div id="orders-container" class="space-y-6">
        <!-- Orders will be dynamically inserted here -->
      </div>

      <!-- Empty State -->
      <div id="empty-state" class="text-center py-16 hidden">
        <i class="fas fa-coffee text-6xl text-gray-300 mb-4"></i>
        <h3 class="text-xl font-semibold text-gray-600 mb-2">No orders found</h3>
        <p class="text-gray-500">Start by placing your first order from our menu!</p>
        <a href="menu.html" class="inline-block mt-4 bg-yellow-500 text-white px-6 py-3 rounded-full font-semibold hover:bg-yellow-600 transition">
          Browse Menu
        </a>
      </div>
    </div>
  </section>

  <!-- Cancel Confirmation Modal -->
  <div id="cancel-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-xl p-8 max-w-md mx-4">
      <!-- Content will be dynamically generated -->
    </div>
  </div>

  <script>
    let currentTab = 'all';
    let orders = [];
    let orderToCancel = null;

    // Initialize dummy data
    function initializeDummyData() {
      if (!localStorage.getItem("orders")) {
        const dummyOrders = [
          {
            id: 'ORD001',
            items: [
              { name: "Caramel Latte", quantity: 2, price: 3.0 },
              { name: "Mocha Latte", quantity: 1, price: 3.0 }
            ],
            total: 9.0,
            status: "Completed",
            date: "2025-06-18T10:00:00",
            estimatedTime: null
          },
          {
            id: 'ORD002',
            items: [
              { name: "Milky Iced Salted Caramel Latte", quantity: 1, price: 4.0 },
              { name: "NESCAFÉ Cereal Milk Smoothie", quantity: 2, price: 6.0 }
            ],
            total: 16.0,
            status: "Pending",
            date: "2025-06-22T09:30:00",
            estimatedTime: "15 minutes"
          },
          {
            id: 'ORD003',
            items: [
              { name: "Hazelnut Latte", quantity: 1, price: 3.0 }
            ],
            total: 3.0,
            status: "Completed",
            date: "2025-06-20T08:45:00",
            estimatedTime: null
          },
          {
            id: 'ORD004',
            items: [
              { name: "Vanilla Latte", quantity: 2, price: 3.5 },
              { name: "Chocolate Croissant", quantity: 1, price: 2.5 }
            ],
            total: 9.5,
            status: "Cancelled",
            date: "2025-06-21T14:20:00",
            estimatedTime: null
          },
          {
            id: 'ORD005',
            items: [
              { name: "Espresso", quantity: 3, price: 2.0 }
            ],
            total: 6.0,
            status: "Pending",
            date: "2025-06-22T11:15:00",
            estimatedTime: "8 minutes"
          }
        ];
        localStorage.setItem("orders", JSON.stringify(dummyOrders));
      }
    }

    // Load orders from localStorage
    function loadOrders() {
      orders = JSON.parse(localStorage.getItem("orders")) || [];
    }

    // Save orders to localStorage
    function saveOrders() {
      localStorage.setItem("orders", JSON.stringify(orders));
    }

    // Format date
    function formatDate(dateStr) {
      const d = new Date(dateStr);
      return d.toLocaleString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // Get relative time
    function getRelativeTime(dateStr) {
      const now = new Date();
      const orderDate = new Date(dateStr);
      const diffMs = now - orderDate;
      const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
      const diffDays = Math.floor(diffHours / 24);

      if (diffDays > 0) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
      if (diffHours > 0) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
      return 'Just now';
    }

    // Update statistics
    function updateStatistics() {
      const total = orders.length;
      const pending = orders.filter(o => o.status === 'Pending').length;
      const completed = orders.filter(o => o.status === 'Completed').length;
      const cancelled = orders.filter(o => o.status === 'Cancelled').length;

      document.getElementById('total-orders').textContent = total;
      document.getElementById('pending-count').textContent = pending;
      document.getElementById('completed-count').textContent = completed;
      document.getElementById('cancelled-count').textContent = cancelled;
    }

    // Create order card HTML
    function createOrderCard(order, index) {
      const statusConfig = {
        'Pending': { 
          class: 'bg-yellow-100 text-yellow-700 status-badge pending', 
          icon: 'fas fa-clock',
          color: 'yellow'
        },
        'Completed': { 
          class: 'bg-green-100 text-green-700 status-badge completed', 
          icon: 'fas fa-check-circle',
          color: 'green'
        },
        'Cancelled': { 
          class: 'bg-red-100 text-red-700 status-badge cancelled', 
          icon: 'fas fa-times-circle',
          color: 'red'
        }
      };

      const config = statusConfig[order.status];
      const relativeTime = getRelativeTime(order.date);

      const itemsHtml = order.items.map(item =>
        `<div class="flex justify-between items-center py-1">
          <span class="text-gray-700">${item.quantity}× ${item.name}</span>
          <span class="font-semibold text-gray-800">RM ${(item.price * item.quantity).toFixed(2)}</span>
        </div>`
      ).join("");

      const estimatedTimeHtml = order.estimatedTime && order.status === 'Pending' 
        ? `<div class="mt-2 text-sm text-blue-600 font-medium">
             <i class="fas fa-hourglass-half mr-1"></i>
             Est. ready in ${order.estimatedTime}
           </div>`
        : order.status === 'Cancelled' && order.cancelledDate
        ? `<div class="mt-2 text-sm text-red-600 font-medium">
             <i class="fas fa-ban mr-1"></i>
             Cancelled on ${formatDate(order.cancelledDate)}
           </div>`
        : '';

      const cancelButtonHtml = order.status === 'Pending' 
        ? `<button class="cancel-btn bg-red-500 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-red-600 transition" data-index="${index}">
             <i class="fas fa-times mr-1"></i>Cancel Order
           </button>`
        : '';

      return `
        <div class="order-card bg-white rounded-xl shadow-lg p-6 border-l-4 border-${config.color}-400">
          <div class="flex flex-col md:flex-row md:items-center justify-between mb-4">
            <div class="flex items-center mb-2 md:mb-0">
              <div class="bg-${config.color}-100 rounded-full p-3 mr-4">
                <i class="${config.icon} text-${config.color}-600 text-xl"></i>
              </div>
              <div>
                <h3 class="font-bold text-lg text-gray-800">${order.id || `Order #${index + 1}`}</h3>
                <p class="text-sm text-gray-500">${formatDate(order.date)} • ${relativeTime}</p>
              </div>
            </div>
            <div class="flex items-center gap-3">
              <span class="px-3 py-1 rounded-full text-sm font-semibold ${config.class}">
                <i class="${config.icon} mr-1"></i>${order.status}
              </span>
            </div>
          </div>

          <div class="border-t border-gray-100 pt-4">
            <div class="space-y-2 mb-4">
              ${itemsHtml}
            </div>
            
            <div class="flex flex-col md:flex-row md:items-center justify-between pt-3 border-t border-gray-100">
              <div class="mb-2 md:mb-0">
                <span class="text-lg font-bold text-gray-800">Total: RM ${order.total.toFixed(2)}</span>
                ${estimatedTimeHtml}
              </div>
              ${cancelButtonHtml}
            </div>
          </div>
        </div>
      `;
    }

    // Filter and render orders
    function renderOrders() {
      const container = document.getElementById('orders-container');
      const emptyState = document.getElementById('empty-state');
      
      let filteredOrders = orders;
      
      if (currentTab !== 'all') {
        const statusMap = {
          'pending': 'Pending',
          'completed': 'Completed',
          'cancelled': 'Cancelled'
        };
        filteredOrders = orders.filter(order => order.status === statusMap[currentTab]);
      }

      if (filteredOrders.length === 0) {
        container.innerHTML = '';
        emptyState.classList.remove('hidden');
        return;
      }

      emptyState.classList.add('hidden');
      
      // Sort orders by date (newest first)
      filteredOrders.sort((a, b) => new Date(b.date) - new Date(a.date));
      
      // Clear container first
      container.innerHTML = '';
      
      // Create order cards
      filteredOrders.forEach((order, displayIndex) => {
        const originalIndex = orders.findIndex(o => 
          o.id === order.id || 
          (o.date === order.date && o.total === order.total && o.status === order.status)
        );
        
        const orderCard = document.createElement('div');
        orderCard.innerHTML = createOrderCard(order, originalIndex);
        container.appendChild(orderCard);
        
        // Add cancel button functionality immediately
        const cancelBtn = orderCard.querySelector('.cancel-btn');
        if (cancelBtn) {
          cancelBtn.onclick = function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Cancel clicked for order index:', originalIndex);
            showCancelModal(originalIndex);
          };
        }
      });
    }

    // Show cancel confirmation modal
    function showCancelModal(index) {
      console.log('Showing cancel modal for order:', orders[index]);
      orderToCancel = index;
      const modal = document.getElementById('cancel-modal');
      modal.classList.remove('hidden');
      
      // Update modal content with order details
      const orderInfo = orders[index];
      if (orderInfo) {
        const modalContent = modal.querySelector('.bg-white');
        modalContent.innerHTML = `
          <div class="text-center">
            <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
            <h3 class="text-xl font-semibold mb-4">Cancel Order?</h3>
            <p class="text-gray-600 mb-2">Order: ${orderInfo.id || 'Order #' + (index + 1)}</p>
            <p class="text-gray-600 mb-6">Are you sure you want to cancel this order? This action cannot be undone.</p>
            <div class="flex gap-4">
              <button id="modal-cancel-confirm" class="flex-1 bg-red-500 text-white py-3 rounded-lg font-semibold hover:bg-red-600 transition">
                Yes, Cancel Order
              </button>
              <button id="modal-cancel-close" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-400 transition">
                Keep Order
              </button>
            </div>
          </div>
        `;
        
        // Add event listeners to new buttons
        document.getElementById('modal-cancel-confirm').onclick = function() {
          console.log('Confirming cancellation for index:', orderToCancel);
          if (orderToCancel !== null) {
            cancelOrder(orderToCancel);
            hideCancelModal();
          }
        };
        
        document.getElementById('modal-cancel-close').onclick = function() {
          hideCancelModal();
        };
      }
    }

    // Hide cancel modal
    function hideCancelModal() {
      const modal = document.getElementById('cancel-modal');
      modal.classList.add('hidden');
      orderToCancel = null;
    }

    // Cancel order
    function cancelOrder(index) {
      console.log('Attempting to cancel order at index:', index); // Debug log
      console.log('Order details:', orders[index]); // Debug log
      
      if (orders[index] && orders[index].status === 'Pending') {
        console.log('Cancelling order:', orders[index].id); // Debug log
        
        // Change status to Cancelled
        orders[index].status = 'Cancelled';
        
        // Add cancellation timestamp
        orders[index].cancelledDate = new Date().toISOString();
        
        // Remove estimated time since order is cancelled
        orders[index].estimatedTime = null;
        
        // Save to localStorage
        saveOrders();
        
        // Update statistics
        updateStatistics();
        
        // Re-render orders to show updated status
        renderOrders();
        
        // Show success message
        showNotification('Order cancelled successfully and moved to Cancelled orders', 'success');
        
        // If currently viewing pending tab, switch to cancelled tab to show the cancelled order
        if (currentTab === 'pending') {
          // Switch to cancelled tab after a short delay
          setTimeout(() => {
            document.querySelector('[data-tab="cancelled"]').click();
            showNotification('Viewing cancelled orders', 'info');
          }, 1500);
        }
      } else {
        console.error('Cannot cancel order - not found or not pending'); // Debug log
        showNotification('Unable to cancel order', 'error');
      }
    }

    // Show notification
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `fixed top-24 right-6 z-50 px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 ${
        type === 'success' ? 'bg-green-500 text-white' : 
        type === 'error' ? 'bg-red-500 text-white' : 'bg-blue-500 text-white'
      }`;
      notification.innerHTML = `
        <div class="flex items-center">
          <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'} mr-2"></i>
          <span>${message}</span>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 100);
      
      setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
          if (document.body.contains(notification)) {
            document.body.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // Update current time
    function updateCurrentTime() {
      const now = new Date();
      document.getElementById('current-time').textContent = now.toLocaleString();
    }

    // Tab switching
    document.querySelectorAll('.tab-button').forEach(button => {
      button.addEventListener('click', function() {
        // Remove active class from all buttons
        document.querySelectorAll('.tab-button').forEach(btn => {
          btn.classList.remove('active', 'bg-yellow-500', 'text-white');
          btn.classList.add('bg-white', 'text-gray-700');
        });
        
        // Add active class to clicked button
        this.classList.add('active', 'bg-yellow-500', 'text-white');
        this.classList.remove('bg-white', 'text-gray-700');
        
        currentTab = this.dataset.tab;
        renderOrders();
      });
    });

    // Modal event listeners - Remove these since we handle them dynamically now
    // The event listeners are now added directly when the modal is shown

    // Close modal on backdrop click
    document.getElementById('cancel-modal').addEventListener('click', function(e) {
      if (e.target === this) {
        e.preventDefault();
        hideCancelModal();
      }
    });

    // Also close modal on Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && !document.getElementById('cancel-modal').classList.contains('hidden')) {
        hideCancelModal();
      }
    });

    // Mobile menu toggle
    document.getElementById('mobile-menu-button').addEventListener('click', function() {
      const mobileMenu = document.getElementById('mobile-menu');
      mobileMenu.classList.toggle('open');
    });

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      initializeDummyData();
      loadOrders();
      updateStatistics();
      renderOrders();
      updateCurrentTime();
      
      // Update time every minute
      setInterval(updateCurrentTime, 60000);
    });
  </script>
</body>
</html>